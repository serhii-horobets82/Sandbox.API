{
  "version": "2.0.0",
  "inputs": [
    {
      "id": "migrationName",
      "type": "promptString",
      "description": "Name of migration",
      "default": "Initial"
    }
  ],
  "tasks": [
    {
      "label": "ef: Context info",
      "command": "dotnet",
      "type": "process",
      "args": ["ef", "dbcontext", "info", "--context", "EvoflareDbContext"],
      "problemMatcher": []
    },
    {
      "label": "ef: Create migration",
      "command": "dotnet",
      "type": "process",
      "args": [
        "ef",
        "migrations",
        "add",
        "${input:migrationName}",
        "--context",
        "EvoflareDbContext"
      ],
      "problemMatcher": []
    },
    {
      "label": "ef: Update database",
      "command": "dotnet",
      "type": "process",
      "args": ["ef", "database", "update", "--context", "EvoflareDbContext"],
      "problemMatcher": []
    },
    {
      "label": "ef: Remove migration",
      "command": "dotnet",
      "type": "process",
      "args": ["ef", "migrations", "remove", "--context", "EvoflareDbContext"],
      "problemMatcher": []
    },
    {
      "label": "app: Build",
      "command": "dotnet",
      "type": "process",
      "args": ["build", "${workspaceFolder}/Evoflare.API.csproj"],
      "problemMatcher": []
    },
    {
      "label": "app: Run",
      "command": "dotnet",
      "type": "process",
      "args": ["run", "${workspaceFolder}/Evoflare.API.csproj"],
      "problemMatcher": []
    },
    {
      "label": "app: Generate seed-classes",
      "command": "dotnet",
      "type": "process",
      "group": "build",
      "args": ["run", "${workspaceFolder}/Evoflare.API.csproj", "export-data=true"],
      "problemMatcher": []
    },
    { 
      "label": "app: Publish",
      "command": "dotnet",
      "type": "process",
      "args": ["publish", "${workspaceFolder}/Evoflare.API.csproj"],
      "problemMatcher": []
    },
    {
      "label": "app: Watch",
      "command": "dotnet",
      "type": "process",
      "args": [
        "watch",
        "--urls http://*:5000",
        "run",
        "${workspaceFolder}/Evoflare.API.csproj"
      ],
      "problemMatcher": []
    },
    {
      "label": "app: Scaffold database",
      "type": "shell",
      "command": "echo Done",
      "group": "build",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Scaffold database(dbo schema)",
        "Patch EvofalreDbContext file"
      ],
      "problemMatcher": []
    },
    {
      "label": "child-task: Scaffold database(dbo schema)",
      "command": "dotnet",
      "type": "process",
      "args": [
        "ef",
        "dbcontext",
        "scaffold",
        "\"${config:mssql.connections.0.connectionString}\"",
        "Microsoft.EntityFrameworkCore.SqlServer",
        "-c",
        "EvoflareDbContext",
        "-o",
        "Models",
        "-v",
        "--context-dir",
        "Data",
        "--schema",
        "dbo",
        "--data-annotations",
        "--force"
      ],
      "problemMatcher": []
    },
    {
      "label": "child-task: Patch EvofalreDbContext file",
      "type": "shell",
      "command": "(Get-Content -path EvoflareDbContext.cs -Raw) -replace ' modelBuilder.HasAnnotation','base.OnModelCreating(modelBuilder);\n\rmodelBuilder.HasAnnotation' -replace ': DbContext',': BaseDbContext' -replace '#warning.*','' -replace '#warning.*',''  | Out-File EvoflareDbContext.cs",
      "options": {
        "cwd": "${workspaceRoot}/Data"
      },
      "problemMatcher": []
    },
    {
      "label": "docker: Build and run DB(mssql) container",
      "type": "process",
      "command": "start-docker-sql.cmd",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "group": "docker"
      },
      "options": {
        "cwd": "${workspaceRoot}/Docker"
      },
      "problemMatcher": []
    },
    {
      "label": "docker: Build and run DB(postgres) container",
      "type": "process",
      "command": "start-docker-postgres.cmd",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "group": "docker"
      },
      "options": {
        "cwd": "${workspaceRoot}/Docker"
      },
      "problemMatcher": []
    },
    {
      "label": "docker: Build and run API container",
      "type": "process",
      "command": "start-docker-api.cmd",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "group": "docker"
      },
      "options": {
        "cwd": "${workspaceRoot}/Docker"
      },
      "problemMatcher": []
    },
    {
      "label": "docker: Start DB(mssql) container",
      "type": "shell",
      "command": "docker start evoflare-db",
      "options": {
        "cwd": "${workspaceRoot}/Docker"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "group": "docker"
      },
      "problemMatcher": []
    },
    {
      "label": "docker: Stop DB(mssql) container",
      "type": "shell",
      "command": "docker stop evoflare-db",
      "options": {
        "cwd": "${workspaceRoot}/Docker"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "group": "docker"
      },
      "problemMatcher": []
    },
    {
      "label": "docker: Stop API container",
      "type": "shell",
      "command": "docker stop evoflare-api",
      "options": {
        "cwd": "${workspaceRoot}/Docker"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "group": "docker"
      },
      "problemMatcher": []
    },
    {
      "label": "docker: Start API container",
      "type": "shell",
      "command": "docker start evoflare-api",
      "options": {
        "cwd": "${workspaceRoot}/Docker"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "group": "docker"
      },
      "problemMatcher": []
    }
  ]
}
